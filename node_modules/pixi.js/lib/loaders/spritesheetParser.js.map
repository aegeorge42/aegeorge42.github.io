{"version":3,"sources":["../../src/loaders/spritesheetParser.js"],"names":["spritesheetParser","resource","next","imageResourceName","name","data","type","TYPE","JSON","frames","resources","loadOptions","crossOrigin","metadata","imageMetadata","parentResource","resourcePath","getResourcePath","baseUrl","add","onImageLoad","res","error","spritesheet","texture","baseTexture","url","parse","textures","isDataUrl","meta","image","resolve","replace"],"mappings":";;;;kBAIe,YACf;AACI,WAAO,SAASA,iBAAT,CAA2BC,QAA3B,EAAqCC,IAArC,EACP;AACI,YAAMC,oBAAuBF,SAASG,IAAhC,WAAN;;AAEA;AACA,YAAI,CAACH,SAASI,IAAV,IACGJ,SAASK,IAAT,KAAkB,yBAASC,IAAT,CAAcC,IADnC,IAEG,CAACP,SAASI,IAAT,CAAcI,MAFlB,IAGG,KAAKC,SAAL,CAAeP,iBAAf,CAHP,EAKA;AACID;;AAEA;AACH;;AAED,YAAMS,cAAc;AAChBC,yBAAaX,SAASW,WADN;AAEhBC,sBAAUZ,SAASY,QAAT,CAAkBC,aAFZ;AAGhBC,4BAAgBd;AAHA,SAApB;;AAMA,YAAMe,eAAeC,gBAAgBhB,QAAhB,EAA0B,KAAKiB,OAA/B,CAArB;;AAEA;AACA,aAAKC,GAAL,CAAShB,iBAAT,EAA4Ba,YAA5B,EAA0CL,WAA1C,EAAuD,SAASS,WAAT,CAAqBC,GAArB,EACvD;AACI,gBAAIA,IAAIC,KAAR,EACA;AACIpB,qBAAKmB,IAAIC,KAAT;;AAEA;AACH;;AAED,gBAAMC,cAAc,sBAChBF,IAAIG,OAAJ,CAAYC,WADI,EAEhBxB,SAASI,IAFO,EAGhBJ,SAASyB,GAHO,CAApB;;AAMAH,wBAAYI,KAAZ,CAAkB,YAClB;AACI1B,yBAASsB,WAAT,GAAuBA,WAAvB;AACAtB,yBAAS2B,QAAT,GAAoBL,YAAYK,QAAhC;AACA1B;AACH,aALD;AAMH,SArBD;AAsBH,KA/CD;AAgDH,C;;QAEee,e,GAAAA,e;;AAxDhB;;AACA;;;;AACA;;;;AAsDO,SAASA,eAAT,CAAyBhB,QAAzB,EAAmCiB,OAAnC,EACP;AACI;AACA,QAAIjB,SAAS4B,SAAb,EACA;AACI,eAAO5B,SAASI,IAAT,CAAcyB,IAAd,CAAmBC,KAA1B;AACH;;AAED,WAAO,cAAIC,OAAJ,CAAY/B,SAASyB,GAAT,CAAaO,OAAb,CAAqBf,OAArB,EAA8B,EAA9B,CAAZ,EAA+CjB,SAASI,IAAT,CAAcyB,IAAd,CAAmBC,KAAlE,CAAP;AACH","file":"spritesheetParser.js","sourcesContent":["import { Resource } from 'resource-loader';\nimport url from 'url';\nimport { Spritesheet } from '../core';\n\nexport default function ()\n{\n    return function spritesheetParser(resource, next)\n    {\n        const imageResourceName = `${resource.name}_image`;\n\n        // skip if no data, its not json, it isn't spritesheet data, or the image resource already exists\n        if (!resource.data\n            || resource.type !== Resource.TYPE.JSON\n            || !resource.data.frames\n            || this.resources[imageResourceName]\n        )\n        {\n            next();\n\n            return;\n        }\n\n        const loadOptions = {\n            crossOrigin: resource.crossOrigin,\n            metadata: resource.metadata.imageMetadata,\n            parentResource: resource,\n        };\n\n        const resourcePath = getResourcePath(resource, this.baseUrl);\n\n        // load the image for this sheet\n        this.add(imageResourceName, resourcePath, loadOptions, function onImageLoad(res)\n        {\n            if (res.error)\n            {\n                next(res.error);\n\n                return;\n            }\n\n            const spritesheet = new Spritesheet(\n                res.texture.baseTexture,\n                resource.data,\n                resource.url\n            );\n\n            spritesheet.parse(() =>\n            {\n                resource.spritesheet = spritesheet;\n                resource.textures = spritesheet.textures;\n                next();\n            });\n        });\n    };\n}\n\nexport function getResourcePath(resource, baseUrl)\n{\n    // Prepend url path unless the resource image is a data url\n    if (resource.isDataUrl)\n    {\n        return resource.data.meta.image;\n    }\n\n    return url.resolve(resource.url.replace(baseUrl, ''), resource.data.meta.image);\n}\n"]}